
setwd("/Users/giulia/fires")
library(RStoolbox)
library(ggplot2)

doc <- brick("Data") #  file da nasa

## Unsupervised clustering with kmeans ##
set.seed(42)
MapTheme <- list(theme(
  axis.text = element_text(size = 6),  
  axis.text.y = element_text(angle = 90, hjust = 0.5),
  axis.title = element_blank()
))  
lsat_fire <- unsuperClass(doc, nClasses = 4, output = "classes")
lsat_fire
ggR(lsat_fire$map, forceCat = TRUE, geom_raster = TRUE) +
  scale_fill_viridis_d(name = "Cluster", option = "A") + MapTheme
  
 # ok però serve fare crop 
 
 ## distances ##
 set.seed(42)
lsat_fired <- unsuperClass(doc, nClasses = 4, output = "distances")
lsat_fired
ggR(lsat_fird$map, layer = 1:4, geom_raster = TRUE) +
  scale_fill_viridis_c(name = "Distance", direction = -1) + MapTheme

# per qualche motivo non funzione -> Error in .local(x, ...) : not a valid subset
  
  
  ## spectral angle mapper ##
  classCentroids <- lsat_fired$model$centers
lsat_sa <- sam(doc, em = classCentroids, angles = TRUE)
lsat_sa
ggR(lsat_sa, 1:4, geom_raster = TRUE) +
  scale_fill_viridis_c(name = "Spectral angle", direction = -1) + MapTheme
  # questo tecnicamente ha funzionato la mappa ha poco senso (crop?)
  
  ## Spectral unmixing ##
  lsat_umx <- mesma(doc, em = classCentroids)
lsat_umx

ggR(lsat_umx, 1:4, geom_raster = TRUE) +
   scale_fill_viridis_c(name = "Probability") + MapTheme
   
   # idem come sopra 

## con file .nc e provo crop 
library(ncdf4)
fire20 <- brick("20fire.nc")
ext <- c(69,50,15,0)
fire20c <- crop(fire20, ext)
# mi dà errore: Error in .local(x, y, ...) : Cannot get an Extent object from argument y

# però .nc con library funziona 
